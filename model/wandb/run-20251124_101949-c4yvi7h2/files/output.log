Number of PPI layers: 156 156 156 156
Number of nodes: 218 Number of edges: 4018
{'corneal keratocyte': <networkx.classes.graph.Graph object at 0x7f7d9e09f6a0>, 'adipocyte': <networkx.classes.graph.Graph object at 0x7f7d9e09f0a0>, 'double-positive, alpha-beta thymocyte': <networkx.classes.graph.Graph object at 0x7f7d9e09f5b0>, 'tendon cell': <networkx.classes.graph.Graph object at 0x7f7d9e09feb0>, 'myoepithelial cell': <networkx.classes.graph.Graph object at 0x7f7d9e09fdc0>, 'respiratory mucous cell': <networkx.classes.graph.Graph object at 0x7f7d9e09fc10>, 'myeloid progenitor': <networkx.classes.graph.Graph object at 0x7f7d9e09fd90>, 'tongue muscle cell': <networkx.classes.graph.Graph object at 0x7f7d9e09fbe0>, 'melanocyte': <networkx.classes.graph.Graph object at 0x7f7d9e09f910>, 'plasma cell': <networkx.classes.graph.Graph object at 0x7f7d9e09f730>, 'kidney epithelial cell': <networkx.classes.graph.Graph object at 0x7f7d9e0b6c40>, 'eye photoreceptor cell': <networkx.classes.graph.Graph object at 0x7f7d9e0b6d00>, 'stromal cell': <networkx.classes.graph.Graph object at 0x7f7d9e0b6dc0>, 'conjunctival epithelial cell': <networkx.classes.graph.Graph object at 0x7f7c726a6ac0>, 'type i nk t cell': <networkx.classes.graph.Graph object at 0x7f7d9e129a60>, 'luminal cell of prostate epithelium': <networkx.classes.graph.Graph object at 0x7f7c6fa6ee20>, 'mesothelial cell': <networkx.classes.graph.Graph object at 0x7f7c6fa79250>, 'lymphatic endothelial cell': <networkx.classes.graph.Graph object at 0x7f7c6fb82f40>, 'macrophage': <networkx.classes.graph.Graph object at 0x7f7c6fb82be0>, 'connective tissue cell': <networkx.classes.graph.Graph object at 0x7f7c6fb82f10>, 'intestinal enteroendocrine cell': <networkx.classes.graph.Graph object at 0x7f7c6fb3f0a0>, 'retinal blood vessel endothelial cell': <networkx.classes.graph.Graph object at 0x7f7c6fb3f040>, 'skeletal muscle satellite stem cell': <networkx.classes.graph.Graph object at 0x7f7c6fb3f0d0>, 'mature enterocyte': <networkx.classes.graph.Graph object at 0x7f7c6fb37d30>, 'duct epithelial cell': <networkx.classes.graph.Graph object at 0x7f7c6fb37eb0>, 'transit amplifying cell of large intestine': <networkx.classes.graph.Graph object at 0x7f7c6fb37be0>, 'myofibroblast cell': <networkx.classes.graph.Graph object at 0x7f7c6fb37820>, 'tracheal goblet cell': <networkx.classes.graph.Graph object at 0x7f7c6fb379d0>, 'fibroblast of cardiac tissue': <networkx.classes.graph.Graph object at 0x7f7c6fb37520>, 'vascular associated smooth muscle cell': <networkx.classes.graph.Graph object at 0x7f7c6fb37760>, 'pericyte cell': <networkx.classes.graph.Graph object at 0x7f7c6fb37400>, 'cardiac muscle cell': <networkx.classes.graph.Graph object at 0x7f7c6fb377c0>, 'endothelial cell of hepatic sinusoid': <networkx.classes.graph.Graph object at 0x7f7c6fb373a0>, 'club cell': <networkx.classes.graph.Graph object at 0x7f7c6fb37670>, 'pancreatic ductal cell': <networkx.classes.graph.Graph object at 0x7f7c6fb37100>, 'immature enterocyte': <networkx.classes.graph.Graph object at 0x7f7c6fb37640>, 'hematopoietic stem cell': <networkx.classes.graph.Graph object at 0x7f7c6fb37160>, 'b cell': <networkx.classes.graph.Graph object at 0x7f7c6fb371f0>, 'cd141-positive myeloid dendritic cell': <networkx.classes.graph.Graph object at 0x7f7c6fb37460>, 'fibroblast of breast': <networkx.classes.graph.Graph object at 0x7f7c6fb37970>, 'pancreatic beta cell': <networkx.classes.graph.Graph object at 0x7f7c6fb37e20>, 'small intestine goblet cell': <networkx.classes.graph.Graph object at 0x7f7c6fb9a910>, 'endothelial cell': <networkx.classes.graph.Graph object at 0x7f7c6fb9a5b0>, 'retina horizontal cell': <networkx.classes.graph.Graph object at 0x7f7c6fb9a460>, 'intrahepatic cholangiocyte': <networkx.classes.graph.Graph object at 0x7f7c6fb9a160>, 'pancreatic stellate cell': <networkx.classes.graph.Graph object at 0x7f7c6fb9a250>, 'langerhans cell': <networkx.classes.graph.Graph object at 0x7f7c6fb9af70>, 'type i pneumocyte': <networkx.classes.graph.Graph object at 0x7f7c6fb9ac70>, 'cd24 neutrophil': <networkx.classes.graph.Graph object at 0x7f7c6fb9ac10>, 'luminal epithelial cell of mammary gland': <network
{'acinar cell of salivary gland': 0, 'adipocyte': 1, 'adventitial cell': 2, 'alveolar fibroblast': 3, 'artery endothelial cell': 4, 'b cell': 5, 'basal cell': 6, 'basal cell of prostate epithelium': 7, 'bladder urothelial cell': 8, 'bronchial smooth muscle cell': 9, 'bronchial vessel endothelial cell': 10, 'capillary endothelial cell': 11, 'cardiac endothelial cell': 12, 'cardiac muscle cell': 13, 'cd141-positive myeloid dendritic cell': 14, 'cd1c-positive myeloid dendritic cell': 15, 'cd24 neutrophil': 16, 'cd4-positive helper t cell': 17, 'cd4-positive, alpha-beta memory t cell': 18, 'cd8-positive, alpha-beta cytokine secreting effector t cell': 19, 'cd8-positive, alpha-beta cytotoxic t cell': 20, 'cell of skeletal muscle': 21, 'ciliary body': 22, 'ciliated cell': 23, 'ciliated epithelial cell': 24, 'classical monocyte': 25, 'club cell': 26, 'club cell of prostate epithelium': 27, 'conjunctival epithelial cell': 28, 'connective tissue cell': 29, 'corneal epithelial cell': 30, 'corneal keratocyte': 31, 'dendritic cell': 32, 'dn1 thymic pro-t cell': 33, 'dn3 thymocyte': 34, 'dn4 thymocyte': 35, 'double-positive, alpha-beta thymocyte': 36, 'duct epithelial cell': 37, 'duodenum glandular cell': 38, 'endothelial cell': 39, 'endothelial cell of artery': 40, 'endothelial cell of hepatic sinusoid': 41, 'endothelial cell of lymphatic vessel': 42, 'endothelial cell of vascular tree': 43, 'enterocyte of epithelium of large intestine': 44, 'enterocyte of epithelium of small intestine': 45, 'epithelial cell': 46, 'epithelial cell of lacrimal sac': 47, 'epithelial cell of uterus': 48, 'erythroid progenitor': 49, 'eye photoreceptor cell': 50, 'fast muscle cell': 51, 'fibroblast': 52, 'fibroblast of breast': 53, 'fibroblast of cardiac tissue': 54, 'goblet cell': 55, 'granulocyte': 56, 'gut endothelial cell': 57, 'hematopoietic stem cell': 58, 'hepatocyte': 59, 'hillock cell of prostate epithelium': 60, 'hillock-club cell of prostate epithelium': 61, 'immature enterocyte': 62, 'immature natural killer cell': 63, 'immune cell': 64, 'intermediate monocyte': 65, 'intestinal crypt stem cell': 66, 'intestinal crypt stem cell of large intestine': 67, 'intestinal crypt stem cell of small intestine': 68, 'intestinal enteroendocrine cell': 69, 'intestinal tuft cell': 70, 'intrahepatic cholangiocyte': 71, 'ionocyte': 72, 'keratinocyte': 73, 'kidney epithelial cell': 74, 'lacrimal gland functional unit cell': 75, 'langerhans cell': 76, 'large intestine goblet cell': 77, 'limbal stem cell': 78, 'limbal stromal cell': 79, 'liver dendritic cell': 80, 'luminal cell of prostate epithelium': 81, 'luminal epithelial cell of mammary gland': 82, 'lung ciliated cell': 83, 'lung microvascular endothelial cell': 84, 'lymphatic endothelial cell': 85, 'macrophage': 86, 'mature conventional dendritic cell': 87, 'mature enterocyte': 88, 'mature nk t cell': 89, 'medullary thymic epithelial cell': 90, 'melanocyte': 91, 'memory b cell': 92, 'mesenchymal stem cell': 93, 'mesothelial cell': 94, 'microglial cell': 95, 'monocyte': 96, 'mucus secreting cell': 97, 'muller cell': 98, 'muscle cell': 99, 'myeloid cell': 100, 'myeloid dendritic cell': 101, 'myeloid progenitor': 102, 'myoepithelial cell': 103, 'myofibroblast cell': 104, 'myometrial cell': 105, 'naive regulatory t cell': 106, 'naive thymus-derived cd4-positive, alpha-beta t cell': 107, 'nampt neutrophil': 108, 'nk cell': 109, 'non-classical monocyte': 110, 'ocular surface cell': 111, 'pancreatic acinar cell': 112, 'pancreatic alpha cell': 113, 'pancreatic beta cell': 114, 'pancreatic delta cell': 115, 'pancreatic ductal cell': 116, 'pancreatic pp cell': 117, 'pancreatic stellate cell': 118, 'paneth cell of epithelium of large intestine': 119, 'paneth cell of epithelium of small intestine': 120, 'pericyte cell': 121, 'plasma cell': 122, 'plasmablast': 123, 'plasmacytoid dendritic cell': 124, 'pulmonary ionocyte': 125, 'radial glial cell': 126, 'regulatory t cell': 127, 'respiratory goblet cell': 128, 'respiratory mucous cell': 129, 'retina horizontal cell': 130, 'retinal bipolar neuron': 131, 'retinal blood ves
Using 10 PPI layers for training.
{'acinar cell of salivary gland': 0, 'adipocyte': 1, 'adventitial cell': 2, 'alveolar fibroblast': 3, 'artery endothelial cell': 4, 'b cell': 5, 'basal cell': 6, 'basal cell of prostate epithelium': 7, 'bladder urothelial cell': 8, 'bronchial smooth muscle cell': 9, 'bronchial vessel endothelial cell': 10, 'capillary endothelial cell': 11, 'cardiac endothelial cell': 12, 'cardiac muscle cell': 13, 'cd141-positive myeloid dendritic cell': 14, 'cd1c-positive myeloid dendritic cell': 15, 'cd24 neutrophil': 16, 'cd4-positive helper t cell': 17, 'cd4-positive, alpha-beta memory t cell': 18, 'cd8-positive, alpha-beta cytokine secreting effector t cell': 19, 'cd8-positive, alpha-beta cytotoxic t cell': 20, 'cell of skeletal muscle': 21, 'ciliary body': 22, 'ciliated cell': 23, 'ciliated epithelial cell': 24, 'classical monocyte': 25, 'club cell': 26, 'club cell of prostate epithelium': 27, 'conjunctival epithelial cell': 28, 'connective tissue cell': 29, 'corneal epithelial cell': 30, 'corneal keratocyte': 31, 'dendritic cell': 32, 'dn1 thymic pro-t cell': 33, 'dn3 thymocyte': 34, 'dn4 thymocyte': 35, 'double-positive, alpha-beta thymocyte': 36, 'duct epithelial cell': 37, 'duodenum glandular cell': 38, 'endothelial cell': 39, 'endothelial cell of artery': 40, 'endothelial cell of hepatic sinusoid': 41, 'endothelial cell of lymphatic vessel': 42, 'endothelial cell of vascular tree': 43, 'enterocyte of epithelium of large intestine': 44, 'enterocyte of epithelium of small intestine': 45, 'epithelial cell': 46, 'epithelial cell of lacrimal sac': 47, 'epithelial cell of uterus': 48, 'erythroid progenitor': 49, 'eye photoreceptor cell': 50, 'fast muscle cell': 51, 'fibroblast': 52, 'fibroblast of breast': 53, 'fibroblast of cardiac tissue': 54, 'goblet cell': 55, 'granulocyte': 56, 'gut endothelial cell': 57, 'hematopoietic stem cell': 58, 'hepatocyte': 59, 'hillock cell of prostate epithelium': 60, 'hillock-club cell of prostate epithelium': 61, 'immature enterocyte': 62, 'immature natural killer cell': 63, 'immune cell': 64, 'intermediate monocyte': 65, 'intestinal crypt stem cell': 66, 'intestinal crypt stem cell of large intestine': 67, 'intestinal crypt stem cell of small intestine': 68, 'intestinal enteroendocrine cell': 69, 'intestinal tuft cell': 70, 'intrahepatic cholangiocyte': 71, 'ionocyte': 72, 'keratinocyte': 73, 'kidney epithelial cell': 74, 'lacrimal gland functional unit cell': 75, 'langerhans cell': 76, 'large intestine goblet cell': 77, 'limbal stem cell': 78, 'limbal stromal cell': 79, 'liver dendritic cell': 80, 'luminal cell of prostate epithelium': 81, 'luminal epithelial cell of mammary gland': 82, 'lung ciliated cell': 83, 'lung microvascular endothelial cell': 84, 'lymphatic endothelial cell': 85, 'macrophage': 86, 'mature conventional dendritic cell': 87, 'mature enterocyte': 88, 'mature nk t cell': 89, 'medullary thymic epithelial cell': 90, 'melanocyte': 91, 'memory b cell': 92, 'mesenchymal stem cell': 93, 'mesothelial cell': 94, 'microglial cell': 95, 'monocyte': 96, 'mucus secreting cell': 97, 'muller cell': 98, 'muscle cell': 99, 'myeloid cell': 100, 'myeloid dendritic cell': 101, 'myeloid progenitor': 102, 'myoepithelial cell': 103, 'myofibroblast cell': 104, 'myometrial cell': 105, 'naive regulatory t cell': 106, 'naive thymus-derived cd4-positive, alpha-beta t cell': 107, 'nampt neutrophil': 108, 'nk cell': 109, 'non-classical monocyte': 110, 'ocular surface cell': 111, 'pancreatic acinar cell': 112, 'pancreatic alpha cell': 113, 'pancreatic beta cell': 114, 'pancreatic delta cell': 115, 'pancreatic ductal cell': 116, 'pancreatic pp cell': 117, 'pancreatic stellate cell': 118, 'paneth cell of epithelium of large intestine': 119, 'paneth cell of epithelium of small intestine': 120, 'pericyte cell': 121, 'plasma cell': 122, 'plasmablast': 123, 'plasmacytoid dendritic cell': 124, 'pulmonary ionocyte': 125, 'radial glial cell': 126, 'regulatory t cell': 127, 'respiratory goblet cell': 128, 'respiratory mucous cell': 129, 'retina horizontal cell': 130, 'retinal bipolar neuron': 131, 'retinal blood ves
Center loss labels: Counter({102: 3337, 122: 3178, 1: 3099, 31: 2952, 129: 2939, 146: 2747, 91: 2746, 36: 2628, 103: 2026, 147: 1382})
Pinnacle(
  (conv1_up): PCTConv(
    (ppi_w): ModuleList(
      (0-9): 10 x GATv2Conv(2048, 16, heads=8)
    )
    (mg_conv_in): GATv2Conv(2048, 16, heads=8)
    (mg_conv_out): GATv2Conv(128, 16, heads=8)
  )
  (conv1_down): PPIConv(
    (ppi_w): ModuleList(
      (0-9): 10 x GATv2Conv(128, 16, heads=8)
    )
  )
  (layer_norm1): LayerNorm(128, affine=True, mode=graph)
  (batch_norm1): BatchNorm(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (conv2_up): PCTConv(
    (ppi_w): ModuleList(
      (0-9): 10 x GATv2Conv(128, 8, heads=8)
    )
    (mg_conv_in): GATv2Conv(128, 8, heads=8)
    (mg_conv_out): GATv2Conv(64, 8, heads=8)
  )
  (conv2_down): PPIConv(
    (ppi_w): ModuleList(
      (0-9): 10 x GATv2Conv(64, 8, heads=8)
    )
  )
)
Training batch 1
Traceback (most recent call last):
  File "/opt/ai4g_chriszyyang/buddy1/2_project_ongoing/4-antibio_resistance/PANACEA/PINNACLE/pinnacle/train.py", line 274, in <module>
    main()
  File "/opt/ai4g_chriszyyang/buddy1/2_project_ongoing/4-antibio_resistance/PANACEA/PINNACLE/pinnacle/train.py", line 204, in main
    ppi_metapaths_train, mg_metapaths_train, ppi_metapaths_val, mg_metapaths_val = train(epoch, model, optimizer, center_loss)
  File "/opt/ai4g_chriszyyang/buddy1/2_project_ongoing/4-antibio_resistance/PANACEA/PINNACLE/pinnacle/train.py", line 104, in train
    _, _, mg_pred, ppi_preds_all, ppi_data_train_y, loss = mb_utils.iterate_train_batch(ppi_train_loader_dict, ppi_x_ori, ppi_metapaths, mg_x_ori, mg_metapaths_train, mg_data_train, tissue_neighbors, model, hparams, device, wandb, center_loss, optimizer, train_mask)
  File "/opt/ai4g_chriszyyang/buddy1/2_project_ongoing/4-antibio_resistance/PANACEA/PINNACLE/pinnacle/minibatch_utils.py", line 64, in iterate_train_batch
    ppi_x, mg_x = model(ppi_x, mg_x_ori, ppi_metapaths_batch, mg_metapaths_train, ppi_data_batch, mg_data_train["total_edge_index"], tissue_neighbors)
  File "/data/anaconda3/envs/panacea/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/data/anaconda3/envs/panacea/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/opt/ai4g_chriszyyang/buddy1/2_project_ongoing/4-antibio_resistance/PANACEA/PINNACLE/pinnacle/model.py", line 46, in forward
    ppi_x, mg_x = self.conv1_up(ppi_x, mg_x, ppi_metapaths, mg_metapaths, ppi_edge_index, mg_edge_index, tissue_neighbors, init_cci=True)
  File "/data/anaconda3/envs/panacea/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/data/anaconda3/envs/panacea/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/opt/ai4g_chriszyyang/buddy1/2_project_ongoing/4-antibio_resistance/PANACEA/PINNACLE/pinnacle/conv.py", line 83, in forward
    ppi_x[celltype] = self._per_data_forward(x, ppi_metapaths[celltype], self.ppi_w[celltype])
  File "/data/anaconda3/envs/panacea/lib/python3.9/site-packages/torch/nn/modules/container.py", line 297, in __getitem__
    return self._modules[self._get_abs_string_index(idx)]
  File "/data/anaconda3/envs/panacea/lib/python3.9/site-packages/torch/nn/modules/container.py", line 287, in _get_abs_string_index
    raise IndexError(f'index {idx} is out of range')
IndexError: index 31 is out of range
