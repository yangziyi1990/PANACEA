Number of PPI layers: 156 156 156 156
Number of nodes: 218 Number of edges: 4018
{'corneal keratocyte': <networkx.classes.graph.Graph object at 0x7f057eddc160>, 'adipocyte': <networkx.classes.graph.Graph object at 0x7f057eddc610>, 'double-positive, alpha-beta thymocyte': <networkx.classes.graph.Graph object at 0x7f057eddc7f0>, 'tendon cell': <networkx.classes.graph.Graph object at 0x7f057eddce80>, 'myoepithelial cell': <networkx.classes.graph.Graph object at 0x7f057eddcd90>, 'respiratory mucous cell': <networkx.classes.graph.Graph object at 0x7f057eddcbe0>, 'myeloid progenitor': <networkx.classes.graph.Graph object at 0x7f057eddcd60>, 'tongue muscle cell': <networkx.classes.graph.Graph object at 0x7f057eddcbb0>, 'melanocyte': <networkx.classes.graph.Graph object at 0x7f057eddc8e0>, 'plasma cell': <networkx.classes.graph.Graph object at 0x7f057eddc550>, 'kidney epithelial cell': <networkx.classes.graph.Graph object at 0x7f057edfac40>, 'eye photoreceptor cell': <networkx.classes.graph.Graph object at 0x7f057edfad00>, 'stromal cell': <networkx.classes.graph.Graph object at 0x7f057edfaee0>, 'conjunctival epithelial cell': <networkx.classes.graph.Graph object at 0x7f044f615d30>, 'type i nk t cell': <networkx.classes.graph.Graph object at 0x7f057ee6c8e0>, 'luminal cell of prostate epithelium': <networkx.classes.graph.Graph object at 0x7f044bf28ca0>, 'mesothelial cell': <networkx.classes.graph.Graph object at 0x7f044bffa040>, 'lymphatic endothelial cell': <networkx.classes.graph.Graph object at 0x7f044c052970>, 'macrophage': <networkx.classes.graph.Graph object at 0x7f044c052610>, 'connective tissue cell': <networkx.classes.graph.Graph object at 0x7f044c052400>, 'intestinal enteroendocrine cell': <networkx.classes.graph.Graph object at 0x7f044c052b80>, 'retinal blood vessel endothelial cell': <networkx.classes.graph.Graph object at 0x7f044c052310>, 'skeletal muscle satellite stem cell': <networkx.classes.graph.Graph object at 0x7f044c052070>, 'mature enterocyte': <networkx.classes.graph.Graph object at 0x7f044c052e80>, 'duct epithelial cell': <networkx.classes.graph.Graph object at 0x7f044c052e50>, 'transit amplifying cell of large intestine': <networkx.classes.graph.Graph object at 0x7f044c052b50>, 'myofibroblast cell': <networkx.classes.graph.Graph object at 0x7f044c052a00>, 'tracheal goblet cell': <networkx.classes.graph.Graph object at 0x7f044c052640>, 'fibroblast of cardiac tissue': <networkx.classes.graph.Graph object at 0x7f044c0521f0>, 'vascular associated smooth muscle cell': <networkx.classes.graph.Graph object at 0x7f044c0520a0>, 'pericyte cell': <networkx.classes.graph.Graph object at 0x7f044c052220>, 'cardiac muscle cell': <networkx.classes.graph.Graph object at 0x7f044c052be0>, 'endothelial cell of hepatic sinusoid': <networkx.classes.graph.Graph object at 0x7f044c052730>, 'club cell': <networkx.classes.graph.Graph object at 0x7f044c0525b0>, 'pancreatic ductal cell': <networkx.classes.graph.Graph object at 0x7f044c0528b0>, 'immature enterocyte': <networkx.classes.graph.Graph object at 0x7f044c052880>, 'hematopoietic stem cell': <networkx.classes.graph.Graph object at 0x7f044bfe91c0>, 'b cell': <networkx.classes.graph.Graph object at 0x7f044bfe9730>, 'cd141-positive myeloid dendritic cell': <networkx.classes.graph.Graph object at 0x7f044bfe9fd0>, 'fibroblast of breast': <networkx.classes.graph.Graph object at 0x7f044bfe9f40>, 'pancreatic beta cell': <networkx.classes.graph.Graph object at 0x7f044bfe9d90>, 'small intestine goblet cell': <networkx.classes.graph.Graph object at 0x7f044bfe9c10>, 'endothelial cell': <networkx.classes.graph.Graph object at 0x7f044bfe97c0>, 'retina horizontal cell': <networkx.classes.graph.Graph object at 0x7f044bfe9760>, 'intrahepatic cholangiocyte': <networkx.classes.graph.Graph object at 0x7f044bfe9580>, 'pancreatic stellate cell': <networkx.classes.graph.Graph object at 0x7f044bfe9100>, 'langerhans cell': <networkx.classes.graph.Graph object at 0x7f044bfe9610>, 'type i pneumocyte': <networkx.classes.graph.Graph object at 0x7f044bfe92e0>, 'cd24 neutrophil': <networkx.classes.graph.Graph object at 0x7f044bfe9400>, 'luminal epithelial cell of mammary gland': <network
{'acinar cell of salivary gland': 0, 'adipocyte': 1, 'adventitial cell': 2, 'alveolar fibroblast': 3, 'artery endothelial cell': 4, 'b cell': 5, 'basal cell': 6, 'basal cell of prostate epithelium': 7, 'bladder urothelial cell': 8, 'bronchial smooth muscle cell': 9, 'bronchial vessel endothelial cell': 10, 'capillary endothelial cell': 11, 'cardiac endothelial cell': 12, 'cardiac muscle cell': 13, 'cd141-positive myeloid dendritic cell': 14, 'cd1c-positive myeloid dendritic cell': 15, 'cd24 neutrophil': 16, 'cd4-positive helper t cell': 17, 'cd4-positive, alpha-beta memory t cell': 18, 'cd8-positive, alpha-beta cytokine secreting effector t cell': 19, 'cd8-positive, alpha-beta cytotoxic t cell': 20, 'cell of skeletal muscle': 21, 'ciliary body': 22, 'ciliated cell': 23, 'ciliated epithelial cell': 24, 'classical monocyte': 25, 'club cell': 26, 'club cell of prostate epithelium': 27, 'conjunctival epithelial cell': 28, 'connective tissue cell': 29, 'corneal epithelial cell': 30, 'corneal keratocyte': 31, 'dendritic cell': 32, 'dn1 thymic pro-t cell': 33, 'dn3 thymocyte': 34, 'dn4 thymocyte': 35, 'double-positive, alpha-beta thymocyte': 36, 'duct epithelial cell': 37, 'duodenum glandular cell': 38, 'endothelial cell': 39, 'endothelial cell of artery': 40, 'endothelial cell of hepatic sinusoid': 41, 'endothelial cell of lymphatic vessel': 42, 'endothelial cell of vascular tree': 43, 'enterocyte of epithelium of large intestine': 44, 'enterocyte of epithelium of small intestine': 45, 'epithelial cell': 46, 'epithelial cell of lacrimal sac': 47, 'epithelial cell of uterus': 48, 'erythroid progenitor': 49, 'eye photoreceptor cell': 50, 'fast muscle cell': 51, 'fibroblast': 52, 'fibroblast of breast': 53, 'fibroblast of cardiac tissue': 54, 'goblet cell': 55, 'granulocyte': 56, 'gut endothelial cell': 57, 'hematopoietic stem cell': 58, 'hepatocyte': 59, 'hillock cell of prostate epithelium': 60, 'hillock-club cell of prostate epithelium': 61, 'immature enterocyte': 62, 'immature natural killer cell': 63, 'immune cell': 64, 'intermediate monocyte': 65, 'intestinal crypt stem cell': 66, 'intestinal crypt stem cell of large intestine': 67, 'intestinal crypt stem cell of small intestine': 68, 'intestinal enteroendocrine cell': 69, 'intestinal tuft cell': 70, 'intrahepatic cholangiocyte': 71, 'ionocyte': 72, 'keratinocyte': 73, 'kidney epithelial cell': 74, 'lacrimal gland functional unit cell': 75, 'langerhans cell': 76, 'large intestine goblet cell': 77, 'limbal stem cell': 78, 'limbal stromal cell': 79, 'liver dendritic cell': 80, 'luminal cell of prostate epithelium': 81, 'luminal epithelial cell of mammary gland': 82, 'lung ciliated cell': 83, 'lung microvascular endothelial cell': 84, 'lymphatic endothelial cell': 85, 'macrophage': 86, 'mature conventional dendritic cell': 87, 'mature enterocyte': 88, 'mature nk t cell': 89, 'medullary thymic epithelial cell': 90, 'melanocyte': 91, 'memory b cell': 92, 'mesenchymal stem cell': 93, 'mesothelial cell': 94, 'microglial cell': 95, 'monocyte': 96, 'mucus secreting cell': 97, 'muller cell': 98, 'muscle cell': 99, 'myeloid cell': 100, 'myeloid dendritic cell': 101, 'myeloid progenitor': 102, 'myoepithelial cell': 103, 'myofibroblast cell': 104, 'myometrial cell': 105, 'naive regulatory t cell': 106, 'naive thymus-derived cd4-positive, alpha-beta t cell': 107, 'nampt neutrophil': 108, 'nk cell': 109, 'non-classical monocyte': 110, 'ocular surface cell': 111, 'pancreatic acinar cell': 112, 'pancreatic alpha cell': 113, 'pancreatic beta cell': 114, 'pancreatic delta cell': 115, 'pancreatic ductal cell': 116, 'pancreatic pp cell': 117, 'pancreatic stellate cell': 118, 'paneth cell of epithelium of large intestine': 119, 'paneth cell of epithelium of small intestine': 120, 'pericyte cell': 121, 'plasma cell': 122, 'plasmablast': 123, 'plasmacytoid dendritic cell': 124, 'pulmonary ionocyte': 125, 'radial glial cell': 126, 'regulatory t cell': 127, 'respiratory goblet cell': 128, 'respiratory mucous cell': 129, 'retina horizontal cell': 130, 'retinal bipolar neuron': 131, 'retinal blood ves
{'acinar cell of salivary gland': 0, 'adipocyte': 1, 'adventitial cell': 2, 'alveolar fibroblast': 3, 'artery endothelial cell': 4, 'b cell': 5, 'basal cell': 6, 'basal cell of prostate epithelium': 7, 'bladder urothelial cell': 8, 'bronchial smooth muscle cell': 9, 'bronchial vessel endothelial cell': 10, 'capillary endothelial cell': 11, 'cardiac endothelial cell': 12, 'cardiac muscle cell': 13, 'cd141-positive myeloid dendritic cell': 14, 'cd1c-positive myeloid dendritic cell': 15, 'cd24 neutrophil': 16, 'cd4-positive helper t cell': 17, 'cd4-positive, alpha-beta memory t cell': 18, 'cd8-positive, alpha-beta cytokine secreting effector t cell': 19, 'cd8-positive, alpha-beta cytotoxic t cell': 20, 'cell of skeletal muscle': 21, 'ciliary body': 22, 'ciliated cell': 23, 'ciliated epithelial cell': 24, 'classical monocyte': 25, 'club cell': 26, 'club cell of prostate epithelium': 27, 'conjunctival epithelial cell': 28, 'connective tissue cell': 29, 'corneal epithelial cell': 30, 'corneal keratocyte': 31, 'dendritic cell': 32, 'dn1 thymic pro-t cell': 33, 'dn3 thymocyte': 34, 'dn4 thymocyte': 35, 'double-positive, alpha-beta thymocyte': 36, 'duct epithelial cell': 37, 'duodenum glandular cell': 38, 'endothelial cell': 39, 'endothelial cell of artery': 40, 'endothelial cell of hepatic sinusoid': 41, 'endothelial cell of lymphatic vessel': 42, 'endothelial cell of vascular tree': 43, 'enterocyte of epithelium of large intestine': 44, 'enterocyte of epithelium of small intestine': 45, 'epithelial cell': 46, 'epithelial cell of lacrimal sac': 47, 'epithelial cell of uterus': 48, 'erythroid progenitor': 49, 'eye photoreceptor cell': 50, 'fast muscle cell': 51, 'fibroblast': 52, 'fibroblast of breast': 53, 'fibroblast of cardiac tissue': 54, 'goblet cell': 55, 'granulocyte': 56, 'gut endothelial cell': 57, 'hematopoietic stem cell': 58, 'hepatocyte': 59, 'hillock cell of prostate epithelium': 60, 'hillock-club cell of prostate epithelium': 61, 'immature enterocyte': 62, 'immature natural killer cell': 63, 'immune cell': 64, 'intermediate monocyte': 65, 'intestinal crypt stem cell': 66, 'intestinal crypt stem cell of large intestine': 67, 'intestinal crypt stem cell of small intestine': 68, 'intestinal enteroendocrine cell': 69, 'intestinal tuft cell': 70, 'intrahepatic cholangiocyte': 71, 'ionocyte': 72, 'keratinocyte': 73, 'kidney epithelial cell': 74, 'lacrimal gland functional unit cell': 75, 'langerhans cell': 76, 'large intestine goblet cell': 77, 'limbal stem cell': 78, 'limbal stromal cell': 79, 'liver dendritic cell': 80, 'luminal cell of prostate epithelium': 81, 'luminal epithelial cell of mammary gland': 82, 'lung ciliated cell': 83, 'lung microvascular endothelial cell': 84, 'lymphatic endothelial cell': 85, 'macrophage': 86, 'mature conventional dendritic cell': 87, 'mature enterocyte': 88, 'mature nk t cell': 89, 'medullary thymic epithelial cell': 90, 'melanocyte': 91, 'memory b cell': 92, 'mesenchymal stem cell': 93, 'mesothelial cell': 94, 'microglial cell': 95, 'monocyte': 96, 'mucus secreting cell': 97, 'muller cell': 98, 'muscle cell': 99, 'myeloid cell': 100, 'myeloid dendritic cell': 101, 'myeloid progenitor': 102, 'myoepithelial cell': 103, 'myofibroblast cell': 104, 'myometrial cell': 105, 'naive regulatory t cell': 106, 'naive thymus-derived cd4-positive, alpha-beta t cell': 107, 'nampt neutrophil': 108, 'nk cell': 109, 'non-classical monocyte': 110, 'ocular surface cell': 111, 'pancreatic acinar cell': 112, 'pancreatic alpha cell': 113, 'pancreatic beta cell': 114, 'pancreatic delta cell': 115, 'pancreatic ductal cell': 116, 'pancreatic pp cell': 117, 'pancreatic stellate cell': 118, 'paneth cell of epithelium of large intestine': 119, 'paneth cell of epithelium of small intestine': 120, 'pericyte cell': 121, 'plasma cell': 122, 'plasmablast': 123, 'plasmacytoid dendritic cell': 124, 'pulmonary ionocyte': 125, 'radial glial cell': 126, 'regulatory t cell': 127, 'respiratory goblet cell': 128, 'respiratory mucous cell': 129, 'retina horizontal cell': 130, 'retinal bipolar neuron': 131, 'retinal blood ves
Center loss labels: Counter({35: 3443, 135: 3424, 126: 3384, 102: 3337, 49: 3312, 10: 3312, 56: 3300, 90: 3299, 14: 3296, 30: 3290, 101: 3258, 13: 3247, 68: 3239, 153: 3228, 73: 3217, 94: 3211, 78: 3203, 8: 3198, 52: 3197, 100: 3196, 142: 3186, 6: 3182, 122: 3178, 132: 3176, 39: 3176, 4: 3171, 48: 3168, 149: 3158, 22: 3151, 137: 3134, 86: 3113, 28: 3112, 118: 3110, 62: 3101, 1: 3099, 82: 3094, 128: 3092, 144: 3091, 24: 3078, 66: 3072, 155: 3070, 76: 3065, 116: 3054, 15: 3049, 123: 3041, 25: 3039, 42: 3038, 7: 3036, 150: 3031, 59: 3024, 85: 3023, 136: 3015, 87: 2988, 121: 2986, 111: 2986, 152: 2975, 148: 2965, 138: 2954, 31: 2952, 61: 2952, 129: 2939, 58: 2919, 74: 2909, 40: 2907, 21: 2891, 115: 2869, 96: 2866, 72: 2866, 38: 2850, 69: 2848, 71: 2844, 93: 2834, 97: 2833, 131: 2832, 37: 2821, 46: 2818, 104: 2807, 125: 2784, 2: 2763, 60: 2748, 27: 2748, 146: 2747, 79: 2747, 91: 2746, 114: 2742, 139: 2741, 81: 2738, 120: 2695, 143: 2635, 112: 2629, 36: 2628, 83: 2627, 95: 2606, 65: 2585, 23: 2576, 124: 2545, 154: 2495, 105: 2478, 53: 2472, 80: 2472, 106: 2429, 0: 2386, 130: 2361, 98: 2356, 75: 2323, 113: 2247, 127: 2246, 134: 2225, 99: 2206, 29: 2164, 43: 2163, 41: 2142, 50: 2140, 26: 2140, 12: 2066, 32: 2048, 145: 2028, 103: 2026, 55: 1990, 119: 1965, 45: 1943, 92: 1920, 84: 1908, 140: 1862, 20: 1854, 16: 1837, 54: 1826, 141: 1804, 57: 1781, 19: 1772, 33: 1597, 63: 1578, 70: 1557, 47: 1531, 133: 1461, 109: 1457, 89: 1450, 64: 1435, 9: 1412, 117: 1397, 11: 1394, 110: 1393, 147: 1382, 44: 1320, 51: 1297, 34: 1296, 108: 1291, 17: 1272, 77: 1215, 3: 1201, 5: 1180, 67: 1153, 88: 1103, 107: 1080, 18: 1067, 151: 1007})
Pinnacle(
  (conv1_up): PCTConv(
    (ppi_w): ModuleList(
      (0-155): 156 x GATv2Conv(2048, 16, heads=8)
    )
    (mg_conv_in): GATv2Conv(2048, 16, heads=8)
    (mg_conv_out): GATv2Conv(128, 16, heads=8)
  )
  (conv1_down): PPIConv(
    (ppi_w): ModuleList(
      (0-155): 156 x GATv2Conv(128, 16, heads=8)
    )
  )
  (layer_norm1): LayerNorm(128, affine=True, mode=graph)
  (batch_norm1): BatchNorm(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (conv2_up): PCTConv(
    (ppi_w): ModuleList(
      (0-155): 156 x GATv2Conv(128, 8, heads=8)
    )
    (mg_conv_in): GATv2Conv(128, 8, heads=8)
    (mg_conv_out): GATv2Conv(64, 8, heads=8)
  )
  (conv2_down): PPIConv(
    (ppi_w): ModuleList(
      (0-155): 156 x GATv2Conv(64, 8, heads=8)
    )
  )
)
Training batch 1
Traceback (most recent call last):
  File "/opt/ai4g_chriszyyang/buddy1/2_project_ongoing/4-antibio_resistance/PANACEA/PINNACLE/pinnacle/train.py", line 272, in <module>
    main()
  File "/opt/ai4g_chriszyyang/buddy1/2_project_ongoing/4-antibio_resistance/PANACEA/PINNACLE/pinnacle/train.py", line 200, in main
    ppi_metapaths_train, mg_metapaths_train, ppi_metapaths_val, mg_metapaths_val = train(epoch, model, optimizer, center_loss)
  File "/opt/ai4g_chriszyyang/buddy1/2_project_ongoing/4-antibio_resistance/PANACEA/PINNACLE/pinnacle/train.py", line 100, in train
    _, _, mg_pred, ppi_preds_all, ppi_data_train_y, loss = mb_utils.iterate_train_batch(ppi_train_loader_dict, ppi_x_ori, ppi_metapaths, mg_x_ori, mg_metapaths_train, mg_data_train, tissue_neighbors, model, hparams, device, wandb, center_loss, optimizer, train_mask)
  File "/opt/ai4g_chriszyyang/buddy1/2_project_ongoing/4-antibio_resistance/PANACEA/PINNACLE/pinnacle/minibatch_utils.py", line 64, in iterate_train_batch
    ppi_x, mg_x = model(ppi_x, mg_x_ori, ppi_metapaths_batch, mg_metapaths_train, ppi_data_batch, mg_data_train["total_edge_index"], tissue_neighbors)
  File "/data/anaconda3/envs/panacea/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/data/anaconda3/envs/panacea/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/opt/ai4g_chriszyyang/buddy1/2_project_ongoing/4-antibio_resistance/PANACEA/PINNACLE/pinnacle/model.py", line 46, in forward
    ppi_x, mg_x = self.conv1_up(ppi_x, mg_x, ppi_metapaths, mg_metapaths, ppi_edge_index, mg_edge_index, tissue_neighbors, init_cci=True)
  File "/data/anaconda3/envs/panacea/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/data/anaconda3/envs/panacea/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/opt/ai4g_chriszyyang/buddy1/2_project_ongoing/4-antibio_resistance/PANACEA/PINNACLE/pinnacle/conv.py", line 83, in forward
    ppi_x[celltype] = self._per_data_forward(x, ppi_metapaths[celltype], self.ppi_w[celltype])
  File "/opt/ai4g_chriszyyang/buddy1/2_project_ongoing/4-antibio_resistance/PANACEA/PINNACLE/pinnacle/conv.py", line 60, in _per_data_forward
    out = [node_conv(x, edgetype) for edgetype in edgetypes if edgetype.shape[1] > 0]
  File "/opt/ai4g_chriszyyang/buddy1/2_project_ongoing/4-antibio_resistance/PANACEA/PINNACLE/pinnacle/conv.py", line 60, in <listcomp>
    out = [node_conv(x, edgetype) for edgetype in edgetypes if edgetype.shape[1] > 0]
  File "/data/anaconda3/envs/panacea/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/data/anaconda3/envs/panacea/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/data/anaconda3/envs/panacea/lib/python3.9/site-packages/torch_geometric/nn/conv/gatv2_conv.py", line 286, in forward
    x_l = self.lin_l(x).view(-1, H, C)
  File "/data/anaconda3/envs/panacea/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/data/anaconda3/envs/panacea/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/data/anaconda3/envs/panacea/lib/python3.9/site-packages/torch_geometric/nn/dense/linear.py", line 147, in forward
    return F.linear(x, self.weight, self.bias)
RuntimeError: CUDA error: CUBLAS_STATUS_NOT_INITIALIZED when calling `cublasCreate(handle)`
